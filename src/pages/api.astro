---
import Layout from '../layouts/Layout.astro';
import { CodeBlock } from '../components/CodeBlock';

// Code examples as raw strings to avoid Astro parsing issues
const listToolsExample = `curl -X POST https://mcp.daemon.wallykroeker.com \\
  -H "Content-Type: application/json" \\
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 1
  }'`;

const callToolExample = `curl -X POST https://mcp.daemon.wallykroeker.com \\
  -H "Content-Type: application/json" \\
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "get_telos",
      "arguments": {}
    },
    "id": 2
  }'`;

const jsExample = `async function getDaemonData(tool) {
  const response = await fetch('https://mcp.daemon.wallykroeker.com', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      jsonrpc: '2.0',
      method: 'tools/call',
      params: { name: tool, arguments: {} },
      id: 1
    })
  });

  const data = await response.json();
  return data.result.content[0].text;
}

// Usage
const telos = await getDaemonData('get_telos');`;

const responseExample = `{
  "jsonrpc": "2.0",
  "result": {
    "content": [
      {
        "type": "text",
        "text": "Response content here..."
      }
    ]
  },
  "id": 2
}`;

const mcpConfig = `{
  "mcpServers": {
    "daemon": {
      "url": "https://mcp.daemon.wallykroeker.com"
    }
  }
}`;
---

<Layout title="API | JSON-RPC Documentation for Daemon MCP Server" description="Complete documentation for the Daemon MCP API">
  <main class="relative z-10 pt-20 pb-20 px-6">
    <div class="max-w-5xl mx-auto">
      <!-- Header + Base URL compact -->
      <div class="mb-6">
        <div class="flex flex-wrap items-center justify-between gap-4 mb-2">
          <h1 class="font-display text-3xl sm:text-4xl text-gradient">API Documentation</h1>
          <div class="flex items-center gap-3 px-4 py-2 rounded-lg bg-bg-secondary border border-border-default">
            <span class="font-mono text-xs text-text-tertiary">BASE URL</span>
            <code class="font-mono text-sm text-brand">mcp.daemon.wallykroeker.com</code>
          </div>
        </div>
        <p class="font-body text-text-secondary">
          <span class="text-brand">JSON-RPC 2.0</span> over HTTPS · Model Context Protocol · Publicly accessible
        </p>
      </div>

      <!-- Available Endpoints - Multi-column -->
      <section class="mb-8">
        <h2 class="font-heading text-lg text-text-primary mb-3">Available Endpoints</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_about</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_narrative</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_mission</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_projects</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_telos</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_favorite_books</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_favorite_movies</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_current_location</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_preferences</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_all</code>
          </div>
          <div class="px-3 py-2 rounded-lg bg-bg-secondary/50 border border-border-subtle">
            <code class="font-mono text-xs text-brand">get_section</code>
          </div>
        </div>
      </section>

      <!-- Examples -->
      <section class="mb-12">
        <h2 class="font-heading text-2xl text-text-primary mb-4">Examples</h2>

        <!-- List Tools -->
        <div class="mb-6">
          <h3 class="font-heading text-lg text-text-primary mb-3">List Available Tools</h3>
          <CodeBlock code={listToolsExample} language="bash" client:load />
        </div>

        <!-- Call Tool -->
        <div class="mb-6">
          <h3 class="font-heading text-lg text-text-primary mb-3">Call a Tool</h3>
          <CodeBlock code={callToolExample} language="bash" client:load />
        </div>

        <!-- JavaScript -->
        <div class="mb-6">
          <h3 class="font-heading text-lg text-text-primary mb-3">JavaScript</h3>
          <CodeBlock code={jsExample} language="javascript" client:load />
        </div>
      </section>

      <!-- Response Format -->
      <section class="mb-12">
        <h2 class="font-heading text-2xl text-text-primary mb-4">Response Format</h2>
        <p class="font-body text-text-secondary mb-4">
          All responses follow the JSON-RPC 2.0 specification:
        </p>
        <CodeBlock code={responseExample} language="json" client:load />
      </section>

      <!-- MCP Integration -->
      <section class="mb-12">
        <h2 class="font-heading text-2xl text-text-primary mb-4">MCP Integration</h2>
        <p class="font-body text-text-secondary mb-4">
          To use Daemon with MCP-compatible tools like Claude Code:
        </p>
        <CodeBlock code={mcpConfig} language="json" client:load />
      </section>

      <!-- Footer -->
      <section class="border-t border-border-subtle pt-8">
        <p class="font-body text-sm text-text-tertiary italic">
          The Daemon API is part of the broader vision of everything having an API, as described in "The Real Internet of Things" (2016).
        </p>
      </section>
    </div>
  </main>
</Layout>
